# 开发计划（执行版）

## 1. 目标

- 从“可联调”推进到“可小规模真实试用”。
- 保证主链路稳定、安全、可回归。

## 2. 里程碑状态

### M1 安全基线（P0）

状态: 已完成

已完成项:

1. 核心表 RLS 策略落地（`0004`）
2. claim 解析兼容修复（`0005`）
3. 请求级 RLS 上下文注入（role + jwt sub）
4. 生产环境 mock 鉴权保护阈值
5. RLS 隔离自动化校验脚本

### M2 稳定性与可回归（P0）

状态: 已完成（持续补强）

已完成项:

1. 后端 DB 集成测试（`RUN_DB_TESTS` 开关）
2. CI 增加 Postgres service 测试通道
3. Supabase JWT 冒烟脚本
4. 发布前一键预检脚本
5. GitHub Actions 手动预检 workflow

### M3 产品可用性（P1）

状态: 进行中

目标:

1. 从联调页过渡到更清晰的练习流程页
2. 降低非技术用户测试门槛
3. 增强错误提示的可理解性和可恢复性

### M4 观测与运维（P1）

状态: 待开始

目标:

1. 结构化日志与关键错误聚合
2. 关键指标告警（5xx/慢请求/LLM失败率）
3. 故障排查与回滚手册

## 3. 当前优先级待办

1. P0: 完成远端 API 冒烟闭环（在可达环境固定执行并留存结果）
2. P1: 重构前端为引导式 3 步练习流程
3. P1: 增加会话历史与进度可视化
4. P1: 增加基础可观测性（请求日志 + 异常聚合）

## 4. 完成定义（Definition of Done）

每个需求合并前至少满足：

1. 功能主路径可手动验证
2. 相关自动化测试通过
3. 文档同步更新（技术方案/部署测试/复盘）
4. 有明确回滚路径或降级策略

## 5. 执行节奏建议（2 周）

1. 第 1 周
   - 前端流程重构（M3）
   - 关键错误提示优化
2. 第 2 周
   - 会话历史与进度展示
   - 最小可观测性接入
