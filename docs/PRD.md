# MVP PRD: NVC Practice Coach

## 0. 文档信息

- 版本: v1.2（整合版）
- 更新日期: 2026-02-22
- 阶段: MVP
- 目标: 验证产品是否能有效提升用户在真实冲突中的沟通质量

## 1. 背景与问题

用户在学习《非暴力沟通》后，常出现“懂理论但不会用”的断层：

1. 高压场景下容易回到指责/评判表达
2. 沟通后难复盘，无法持续改进
3. 缺少低成本、高频练习环境

本产品要解决的问题：把 NVC 从知识输入转化为可练习、可反馈、可迁移的技能。

## 2. 产品目标与成功指标

### 2.1 MVP 目标

1. 让新用户在 10 分钟内完成一轮练习
2. 让用户获得可直接复用的表达建议
3. 让用户形成“练习 -> 真实应用 -> 复盘”的闭环

### 2.2 关键指标（建议）

1. 首次练习完成率 >= 70%
2. 完成 3 次练习用户中，主观“有帮助”反馈 >= 60%
3. 次日复盘“已用于真实对话”比例 >= 40%

## 3. 目标用户与场景

### 3.1 目标用户

- 职场中的个体贡献者、管理者、跨部门协作角色
- 对沟通成长有意愿，但缺训练路径

### 3.2 MVP 聚焦场景

1. 向同事给建设性反馈
2. 与上级协商资源/预期
3. 跨部门冲突中的边界表达

## 4. 范围与非目标

### 4.1 MVP 范围（P0）

1. 场景创建（模板或自由输入）
2. 角色对练会话（文字）
3. 每轮反馈（含 OFNR 维度与风险提示）
4. 一键改写
5. 会话总结（行动卡）
6. 次日复盘与周进度

### 4.2 非目标

1. 社区/社交关系链
2. 企业组织级权限管理
3. 语音/视频对练
4. 医疗或心理治疗承诺
5. 本阶段不开发微信小程序
6. 本阶段不开发安卓/iOS 原生 App

### 4.3 P1 已落地能力（当前版本）

1. 跨会话历史列表
2. 单会话完整回看（消息、反馈、总结、复盘）
3. 历史筛选与分页（状态/关键词/日期）
4. 行动卡导出（Markdown/PDF/图片）与分享模板
5. PWA 第一阶段能力（安装入口、更新提示、离线状态提示）
6. 历史会话离线快照（最近会话可离线回看，含容量/时效清理）
7. 新手引导能力（首轮任务条、下一步导航、常用开场句快捷填充）
8. 安装体验增强（取消后入口可恢复、浏览器差异化安装引导）
9. 品牌图标落地（`any + maskable` 图标）

### 4.4 当前阶段范围（PWA-first）

1. 基于现有 Web 增强为 PWA（可安装）
2. 提供基础离线能力（应用壳可访问 + 离线提示）
3. 保持现有业务主链路和鉴权方式不变（Supabase 邮箱登录）

## 5. 核心用户流程

1. 用户创建场景并明确目标
2. 开始会话并发送消息
3. 系统返回 AI 回复与结构化反馈
4. 用户可改写并继续对练
5. 结束会话后生成总结卡
6. 用户完成次日复盘
7. 用户查看周进度趋势

## 6. 页面与交互要求（MVP）

### 6.1 场景页

- 输入最小必填，降低首次使用门槛
- 支持模板快速填充

验收：新用户 2 分钟内可发起会话。

### 6.2 会话页

- 输入框与发送操作清晰
- 返回内容分区展示：AI 回复、反馈、可选改写

验收：单轮操作路径清晰，错误可恢复。

### 6.3 总结页

- 输出可复用的开场句/请求句
- 支持复制并进入复盘

验收：用户可在 30 秒内找到“下一步真实使用表达”。

### 6.4 复盘与进度页

- 复盘问卷轻量（1 分钟内）
- 周进度聚焦可解释指标

验收：用户可看懂趋势，并知道下一步如何继续练习。

### 6.5 PWA 体验要求（当前阶段）

1. 支持浏览器安装（安装入口可见）
2. 安装入口在未安装状态下保持可见（用户取消后可再次触发）
3. 对不支持安装弹窗的浏览器提供手动安装引导
4. 支持离线访问应用壳（不要求离线完整练习）
5. 网络恢复后可提示并继续在线流程
6. 新版本可提示更新并切换

## 7. 业务约束

1. 所有用户数据按用户隔离（RLS + 后端校验）
2. 错误响应统一格式（`error_code`, `message`, `request_id`）
3. 消息接口支持幂等（`client_message_id`）

## 8. API 与数据契约

以下文件是实现事实来源：

1. OpenAPI: `spec/openapi/nvc-practice-coach.v1.yaml`
2. 数据迁移: `db/migrations/0001_init_nvc_practice.sql`
3. 增量迁移:
   - `db/migrations/0002_add_idempotency_keys.sql`
   - `db/migrations/0003_sync_auth_users_to_public_users.sql`
   - `db/migrations/0004_enable_rls_core_tables.sql`
   - `db/migrations/0005_fix_request_user_id_claim_resolution.sql`

## 9. 验收标准（当前阶段）

1. 主链路可跑通：场景 -> 会话 -> 消息 -> 总结 -> 复盘 -> 周进度
2. Supabase JWT 主链路可稳定联调
3. RLS 隔离脚本通过（A/B 用户交叉访问被拦截）
4. 自动化测试与预检可重复执行
5. PWA Manifest 生效且可安装
6. 离线可打开应用壳并看到明确状态提示

## 10. 版本策略

不再维护多份 PRD 版本文件。

- 当前文件作为唯一 PRD
- 重大变更记录在 `docs/STAGE_REVIEW.md`
